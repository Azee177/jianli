# ğŸ“Š å½“å‰ç®€å†æå–å’Œæ’ç‰ˆæ–¹æ¡ˆè¯¦ç»†åˆ†æ

## ğŸ¯ æ•´ä½“æ¶æ„

```
ç”¨æˆ·ä¸Šä¼  â†’ åç«¯è§£æ â†’ ç»“æ„åŒ–æ•°æ® â†’ å‰ç«¯æ¸²æŸ“
   â”‚          â”‚           â”‚             â”‚
   PDF/TXT   Parser    JSONå¯¹è±¡      TipTapç¼–è¾‘å™¨
```

---

## ğŸ“ å®Œæ•´æµç¨‹è§£æ

### é˜¶æ®µ1: æ–‡ä»¶ä¸Šä¼  (Frontend â†’ Backend)

**ä½ç½®**: `apps/web/src/lib/fastapi-hooks.ts`

```javascript
// å‰ç«¯ä¸Šä¼ é€»è¾‘
uploadResume({ file: pdfFile })
  â†“
FormData â†’ POST /resumes
  â†“
åç«¯æ¥æ”¶
```

**æ•°æ®æµ**:
- ç”¨æˆ·é€‰æ‹©æ–‡ä»¶ â†’ `UploadPanel.tsx`
- FormDataå°è£… â†’ `fastapi-hooks.ts`
- HTTP POST â†’ `http://localhost:8000/resumes`

---

### é˜¶æ®µ2: OCRæ–‡æœ¬æå– (Backend)

**ä½ç½®**: `apps/api/app/ocr.py` + `apps/api/app/services/resume_service.py`

#### 2.1 PDF â†’ çº¯æ–‡æœ¬

```python
# OCRæµç¨‹
1. æ¥æ”¶PDFå­—èŠ‚æµ
2. extract_text_from_pdf(file_bytes)
   - ä½¿ç”¨ PyMuPDF (fitz) æå–æ–‡æœ¬
   - é€é¡µè¯»å–: page.get_text("text")
   - æ‹¼æ¥æ‰€æœ‰é¡µé¢æ–‡æœ¬
3. è¿”å›: OcrResult(text=..., page_count=3, confidence=0.95)
```

**å½“å‰æ–¹æ¡ˆç‰¹ç‚¹**:
- âœ… ä¼˜ç‚¹: å¿«é€Ÿï¼Œé€‚åˆæ–‡æœ¬PDF
- âš ï¸ é™åˆ¶: æ‰«æä»¶PDFéœ€è¦çœŸæ­£çš„OCRï¼ˆç›®å‰æœªå®ç°ï¼‰
- âš ï¸ é™åˆ¶: ä¸ä¿ç•™åŸå§‹æ’ç‰ˆä¿¡æ¯ï¼ˆä½ç½®ã€å­—ä½“ã€å¤§å°ï¼‰

#### 2.2 æ–‡æœ¬æ ‡å‡†åŒ–

```python
# æ¸…ç†æ–‡æœ¬
normalized_text = normalize_text(raw_text)
  - æ›¿æ¢ \r\n â†’ \n
  - æ›¿æ¢ \u00a0(ä¸é—´æ–­ç©ºæ ¼) â†’ æ™®é€šç©ºæ ¼
  - æ›¿æ¢ \u2022(é¡¹ç›®ç¬¦å·) â†’ è¿å­—ç¬¦
  - å»é™¤é¦–å°¾ç©ºç™½
```

---

### é˜¶æ®µ3: æ™ºèƒ½è§£æ (Backend Parser)

**ä½ç½®**: `apps/api/app/parser.py`

è¿™æ˜¯æ ¸å¿ƒè§£æé€»è¾‘ï¼Œåˆ†ä¸º5ä¸ªå­æ­¥éª¤ï¼š

#### 3.1 ç« èŠ‚è¯†åˆ« (Block Splitting)

**ç­–ç•¥**: åŸºäºå…³é”®è¯å’Œæ ¼å¼è§„åˆ™

```python
# split_into_blocks() é€»è¾‘
æŒ‰è¡Œæ‰«ææ–‡æœ¬:
  â”œâ”€ æ£€æµ‹ç« èŠ‚æ ‡é¢˜å…³é”®è¯
  â”‚   â”œâ”€ "æ•™è‚²èƒŒæ™¯" â†’ education
  â”‚   â”œâ”€ "é¡¹ç›®ç»å†" â†’ project
  â”‚   â”œâ”€ "å·¥ä½œç»å†" â†’ experience
  â”‚   â”œâ”€ "æŠ€èƒ½" â†’ skills
  â”‚   â””â”€ "è£èª‰" â†’ awards
  â”‚
  â”œâ”€ é‡åˆ°æ–°ç« èŠ‚æ ‡é¢˜æ—¶:
  â”‚   â””â”€ å°†ä¹‹å‰çš„å†…å®¹æ‰“åŒ…æˆä¸€ä¸ªBlock
  â”‚
  â””â”€ è¾“å‡º: List[ResumeBlock]
      â”œâ”€ Block(type="header", text="è‚–æ³½å®‡\nç”·|21å²...")
      â”œâ”€ Block(type="education", text="2025.09-2027.06...")
      â”œâ”€ Block(type="experience", text="2024.12-è‡³ä»Š...")
      â””â”€ ...
```

**è¯†åˆ«è§„åˆ™**:
```python
SECTION_KEYWORDS = {
    "header": ["ä¸ªäººä¿¡æ¯", "è”ç³»", "contact"],
    "education": ["æ•™è‚²", "education", "å­¦å†"],
    "experience": ["å·¥ä½œç»å†", "experience", "å®ä¹ "],
    "project": ["é¡¹ç›®ç»å†", "projects"],
    "skills": ["æŠ€èƒ½", "skills"],
    "awards": ["è£èª‰", "å¥–é¡¹", "awards"]
}
```

**é—®é¢˜**:
- âš ï¸ ä¾èµ–å›ºå®šå…³é”®è¯ï¼Œçµæ´»æ€§å·®
- âš ï¸ æ— æ³•è¯†åˆ«éæ ‡å‡†ç« èŠ‚æ ‡é¢˜
- âš ï¸ åŒä¸€ç« èŠ‚å¤šä¸ªå­é¡¹ä¼šè¢«åˆå¹¶æˆä¸€ä¸ªBlock

#### 3.2 è”ç³»ä¿¡æ¯æå– (Contact Extraction)

**ç­–ç•¥**: æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…

```python
extract_contacts(text):
  â”œâ”€ é‚®ç®±: r"[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}"
  â”œâ”€ ç”µè¯: r"(?:\+?86[-\s]?)?1[3-9]\d{9}"
  â”œâ”€ ç½‘å€: r"https?://[^\s]+"
  â”œâ”€ åŸå¸‚: r"(åŒ—äº¬|ä¸Šæµ·|å¹¿å·|æ·±åœ³...)"
  â””â”€ å§“å: å‰5è¡Œä¸­é•¿åº¦â‰¤15ä¸”ä¸å«ç‰¹æ®Šç¬¦å·çš„è¡Œ
```

**è¾“å‡º**:
```python
ResumeContacts(
    name="è‚–æ³½å®‡",
    email="1779547958@qq.com",
    phone="131-4215-3085",
    location="åŒ—äº¬",
    website=None
)
```

**é—®é¢˜**:
- âš ï¸ å§“åè¯†åˆ«å¯å‘å¼ï¼Œå¯èƒ½è¯¯åˆ¤
- âš ï¸ åªæ”¯æŒä¸­å›½å¤§é™†ç”µè¯æ ¼å¼
- âš ï¸ åŸå¸‚åˆ—è¡¨æœ‰é™

#### 3.3 æŠ€èƒ½è¯†åˆ« (Skill Extraction)

**ç­–ç•¥**: è¯å…¸åŒ¹é…

```python
SKILL_DICTIONARY = [
    "Python", "Java", "C++", "Go", 
    "React", "Vue", "Docker", 
    "LangChain", "LLM", "Machine Learning",
    "æ·±åº¦å­¦ä¹ ", "æœºå™¨å­¦ä¹ ", ...
]

extract_skills(text):
  â””â”€ å…¨æ–‡æœç´¢æŠ€èƒ½è¯å…¸ä¸­çš„è¯
```

**é—®é¢˜**:
- âš ï¸ è¯å…¸æœ‰é™ï¼ˆç›®å‰çº¦48ä¸ªï¼‰
- âš ï¸ æ— æ³•è¯†åˆ«è¯å…¸å¤–çš„æŠ€èƒ½
- âš ï¸ å¯èƒ½è¯¯åŒ¹é…ï¼ˆå¦‚"Java"å¯èƒ½åŒ¹é…åˆ°"JavaScript"ï¼‰

#### 3.4 è¯­è¨€æ£€æµ‹

```python
detect_language(text):
  â”œâ”€ ç»Ÿè®¡ä¸­æ–‡å­—ç¬¦æ•°: len(re.findall(r"[\u4e00-\u9fff]", text))
  â”œâ”€ ç»Ÿè®¡è‹±æ–‡å­—ç¬¦æ•°: len(re.findall(r"[A-Za-z]", text))
  â””â”€ è¿”å›: "zh" if ä¸­æ–‡ >= è‹±æ–‡ else "en"
```

#### 3.5 æ•°æ®ç»“æ„è¾“å‡º

```python
ParsedResume(
    normalized="åŸå§‹æ–‡æœ¬(å·²æ¸…ç†)",
    blocks=[
        ResumeBlock(type="header", text="..."),
        ResumeBlock(type="education", text="..."),
        ...
    ],
    contacts=ResumeContacts(...),
    skills=["Python", "LangChain", ...],
    language="zh"
)
```

---

### é˜¶æ®µ4: æ•°æ®å­˜å‚¨ (Backend Store)

**ä½ç½®**: `apps/api/app/store.py`

```python
# å†…å­˜å­˜å‚¨ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
ResumeStore._resumes = {
    "r_abc123": ResumeRecord(
        id="r_abc123",
        user_id="demo-user",
        source="UPLOAD",
        raw_text="...",
        parsed_blocks=[...],
        skills=[...],
        contacts={...},
        metadata={...},
        created_at=datetime.now()
    )
}
```

**é—®é¢˜**:
- âš ï¸ é‡å¯æœåŠ¡æ•°æ®ä¸¢å¤±
- âš ï¸ ä¸æ”¯æŒæŒä¹…åŒ–
- âš ï¸ æ— æ³•è·¨ç”¨æˆ·å…±äº«

---

### é˜¶æ®µ5: æ¨¡æ¿å¡«å…… (Optional)

**ä½ç½®**: `apps/api/app/services/template_filler.py`

è¿™æ˜¯æˆ‘æ–°å¢çš„åŠŸèƒ½ï¼Œä½†**ç›®å‰å‰ç«¯æ²¡æœ‰ä½¿ç”¨**ã€‚

```python
# æ¨¡æ¿å¡«å……æµç¨‹
ParsedResume â†’ TemplateFiller â†’ HTML
  â”œâ”€ æå–ç« èŠ‚: _extract_sections(blocks)
  â”‚   â””â”€ {'education': [...], 'project': [...]}
  â”‚
  â”œâ”€ æ ¼å¼åŒ–å†…å®¹:
  â”‚   â”œâ”€ _format_section_content() â†’ æ™®é€šç« èŠ‚
  â”‚   â”œâ”€ _format_project_content() â†’ é¡¹ç›®ç»å†
  â”‚   â””â”€ _format_experience_content() â†’ å·¥ä½œç»å†
  â”‚
  â”œâ”€ å¡«å……æ¨¡æ¿å˜é‡:
  â”‚   â””â”€ {{name}} â†’ "è‚–æ³½å®‡"
  â”‚       {{phone}} â†’ "131-4215-3085"
  â”‚       {{education_content}} â†’ "<div>...</div>"
  â”‚
  â””â”€ è¾“å‡º: å®Œæ•´HTMLç®€å†
```

**æ¨¡æ¿ç»“æ„**:
```html
<!-- å·¦ä¸Šè§’æ ¡å¾½ -->
<div style="position: absolute; left: 30px; top: 20px;">
    <img src="æ ¡å¾½URL" />
</div>

<!-- å³ä¸Šè§’ç…§ç‰‡ -->
<div style="position: absolute; right: 30px; top: 20px;">
    <img src="{{photo_url}}" />
</div>

<!-- ä¸­é—´ä¸ªäººä¿¡æ¯ -->
<div style="text-align: center;">
    <h1>{{name}}</h1>
    <div>{{phone}} | {{email}}</div>
</div>

<hr />

<!-- æ•™è‚²èƒŒæ™¯ -->
<section>
    <h2>æ•™è‚²èƒŒæ™¯</h2>
    <div style="height: 1px; background: #663399;"></div>
    {{education_content}}
</section>

<!-- é¡¹ç›®ç»å† -->
<section>
    <h2>é¡¹ç›®ç»å†</h2>
    <div style="height: 1px; background: #663399;"></div>
    {{project_content}}
</section>
...
```

---

### é˜¶æ®µ6: APIå“åº” (Backend â†’ Frontend)

**è¿”å›JSON**:
```json
{
  "id": "r_abc123",
  "raw_text": "å®Œæ•´æ–‡æœ¬å†…å®¹...",
  "parsed_blocks": [
    {
      "type": "header",
      "text": "è‚–æ³½å®‡\nç”·|21å²\n..."
    },
    {
      "type": "education",
      "text": "æ•™è‚²ç»å†\n2025.09-2027.06\n..."
    }
  ],
  "skills": ["Python", "LangChain", "LLM"],
  "contacts": {
    "name": "è‚–æ³½å®‡",
    "email": "1779547958@qq.com",
    "phone": "131-4215-3085",
    "location": "åŒ—äº¬"
  },
  "metadata": {
    "ocrEngine": "pdf-text",
    "pageCount": 2,
    "confidence": 0.95,
    "language": "zh"
  },
  "created_at": "2024-11-07T...",
  "updated_at": "2024-11-07T..."
}
```

---

### é˜¶æ®µ7: å‰ç«¯æ¸²æŸ“ (Frontend)

**ä½ç½®**: `apps/web/src/components/layout/ResumeEditor.tsx`

#### 7.1 æ•°æ®æ¥æ”¶å’Œè½¬æ¢

```typescript
// 1. å‰ç«¯æ¥æ”¶åç«¯å“åº”
const resume = await uploadResume({ file })

// 2. æå–åŸå§‹æ–‡æœ¬ç”¨äºæ˜¾ç¤º
// ä½ç½®: apps/web/src/components/layout/ExtensionLayout.tsx
const html = extractEditorHtmlFromResume(resume)
  â””â”€ å®é™…ä¸Šæ˜¯: resume.raw_text (çº¯æ–‡æœ¬)

// 3. ä¼ é€’ç»™ç¼–è¾‘å™¨
<ResumeEditor content={html} />
```

#### 7.2 TipTapç¼–è¾‘å™¨æ¸²æŸ“

```typescript
// ResumeEditor åˆå§‹åŒ–
const editor = useEditor({
  extensions: [
    StarterKit,        // åŸºç¡€Markdownæ”¯æŒ
    Underline,         // ä¸‹åˆ’çº¿
    TextStyle, Color,  // é¢œè‰²
    FontSize,          // å­—ä½“å¤§å°
    ParagraphSpacing,  // æ®µè½é—´è·
    TextAlign,         // å¯¹é½
    OrderedList,       // æœ‰åºåˆ—è¡¨
    BulletList,        // æ— åºåˆ—è¡¨
    ResizableImage,    // å¯è°ƒæ•´å¤§å°çš„å›¾ç‰‡
    ...
  ],
  content: raw_text,   // ç›´æ¥æ˜¾ç¤ºçº¯æ–‡æœ¬ï¼
})
```

**é—®é¢˜**:
- âš ï¸ **å½“å‰æ²¡æœ‰ä½¿ç”¨ç»“æ„åŒ–æ•°æ®**ï¼
- âš ï¸ **ç›´æ¥æ˜¾ç¤ºraw_textçº¯æ–‡æœ¬**ï¼Œæ²¡æœ‰ä»»ä½•æ ¼å¼
- âš ï¸ **æ²¡æœ‰åº”ç”¨æ¨¡æ¿**
- âš ï¸ **æ²¡æœ‰ä½¿ç”¨parsed_blocksä¿¡æ¯**

---

## ğŸ” å½“å‰æ–¹æ¡ˆçš„æ ¸å¿ƒé—®é¢˜

### é—®é¢˜1: å‰åç«¯æ•°æ®æµä¸å®Œæ•´ âŒ

```
åç«¯è§£æ â”€â”€âœ…â”€â”€ ç»“æ„åŒ–æ•°æ®
              â”‚
              â”œâ”€ parsed_blocks âŒ æœªä½¿ç”¨
              â”œâ”€ skills âŒ åªæ˜¾ç¤ºåœ¨é¢æ¿
              â”œâ”€ contacts âŒ åªæ˜¾ç¤ºåœ¨é¢æ¿
              â””â”€ raw_text âœ… æ˜¾ç¤ºåœ¨ç¼–è¾‘å™¨ (ä½†æ— æ ¼å¼)
```

### é—®é¢˜2: æ²¡æœ‰çœŸæ­£çš„"æ’ç‰ˆ" âŒ

å½“å‰æµç¨‹:
```
PDF â†’ æ–‡æœ¬æå– â†’ æ˜¾ç¤ºçº¯æ–‡æœ¬
```

**ç¼ºå¤±çš„ç¯èŠ‚**:
- âŒ æ²¡æœ‰ç»“æ„åŒ–æ¸²æŸ“
- âŒ æ²¡æœ‰æ¨¡æ¿åº”ç”¨
- âŒ æ²¡æœ‰æ ¼å¼åŒ–
- âŒ æ²¡æœ‰æ ·å¼

### é—®é¢˜3: è§£æèƒ½åŠ›æœ‰é™ âš ï¸

**ç« èŠ‚è¯†åˆ«**:
- ä¾èµ–å›ºå®šå…³é”®è¯
- æ— æ³•å¤„ç†éæ ‡å‡†æ ‡é¢˜
- åŒä¸€ç« èŠ‚å¤šä¸ªå­é¡¹ä¼šè¢«åˆå¹¶

**ä¿¡æ¯æå–**:
- æŠ€èƒ½è¯å…¸æœ‰é™ï¼ˆ48ä¸ªï¼‰
- è”ç³»æ–¹å¼æ­£åˆ™ç®€å•
- å§“åè¯†åˆ«ä¸å‡†ç¡®

### é—®é¢˜4: æ¨¡æ¿æœªè¢«ä½¿ç”¨ âŒ

è™½ç„¶å®ç°äº† `TemplateFiller`ï¼Œä½†:
- âŒ å‰ç«¯æ²¡æœ‰è°ƒç”¨æ¨¡æ¿å¡«å……API
- âŒ ç›´æ¥æ˜¾ç¤ºraw_textè€Œéæ ¼å¼åŒ–HTML
- âŒ æ¨¡æ¿å¡«å……åŠŸèƒ½è¢«æµªè´¹

---

## ğŸ’¡ æ•°æ®æµå¯¹æ¯”

### å½“å‰å®é™…æµç¨‹:
```
PDFæ–‡ä»¶
  â†“ (OCR)
çº¯æ–‡æœ¬
  â†“ (è§£æ)
ç»“æ„åŒ–æ•°æ® (blocks, contacts, skills)
  â†“ (ä¸¢å¼ƒï¼)
raw_text â†’ å‰ç«¯ç¼–è¾‘å™¨ (æ— æ ¼å¼)
```

### ç†æƒ³æµç¨‹:
```
PDFæ–‡ä»¶
  â†“ (OCR + ä¿ç•™å¸ƒå±€)
æ–‡æœ¬ + ä½ç½®ä¿¡æ¯
  â†“ (æ™ºèƒ½è§£æ)
ç»“æ„åŒ–æ•°æ® (ç« èŠ‚ã€æ—¶é—´ã€æ ‡ç­¾)
  â†“ (æ¨¡æ¿å¡«å……)
æ ¼å¼åŒ–HTML
  â†“ (æ¸²æŸ“)
å‰ç«¯ç¼–è¾‘å™¨ (æœ‰æ ¼å¼ã€å¯ç¼–è¾‘)
```

---

## ğŸ“Š æ€»ç»“è¡¨æ ¼

| åŠŸèƒ½æ¨¡å— | å½“å‰çŠ¶æ€ | ä½¿ç”¨æƒ…å†µ | æ•ˆæœ |
|---------|---------|---------|------|
| OCRæ–‡æœ¬æå– | âœ… å·²å®ç° | âœ… æ­£åœ¨ä½¿ç”¨ | åŸºç¡€æ–‡æœ¬æå–æ­£å¸¸ |
| ç« èŠ‚åˆ†å— | âœ… å·²å®ç° | âŒ æœªä½¿ç”¨ | è§£æäº†ä½†å‰ç«¯æ²¡ç”¨ |
| è”ç³»ä¿¡æ¯æå– | âœ… å·²å®ç° | âš ï¸ éƒ¨åˆ†ä½¿ç”¨ | åªåœ¨ä¾§è¾¹æ æ˜¾ç¤º |
| æŠ€èƒ½è¯†åˆ« | âœ… å·²å®ç° | âš ï¸ éƒ¨åˆ†ä½¿ç”¨ | åªåœ¨ä¾§è¾¹æ æ˜¾ç¤º |
| æ¨¡æ¿ç³»ç»Ÿ | âœ… å·²å®ç° | âŒ æœªä½¿ç”¨ | åŠŸèƒ½å®Œæ•´ä½†è¢«æµªè´¹ |
| æ¨¡æ¿å¡«å…… | âœ… å·²å®ç° | âŒ æœªä½¿ç”¨ | ç”ŸæˆHTMLä½†æ²¡äººè°ƒ |
| ç»“æ„åŒ–æ¸²æŸ“ | âŒ æœªå®ç° | âŒ - | å…³é”®ç¼ºå¤± |
| æ ¼å¼ä¿ç•™ | âŒ æœªå®ç° | âŒ - | å…³é”®ç¼ºå¤± |

---

## ğŸ¯ æ ¸å¿ƒé—®é¢˜æ ¹æº

**å‰ç«¯ä»£ç ä½ç½®**: `ExtensionLayout.tsx:57`

```typescript
// é—®é¢˜ä»£ç 
const html = extractEditorHtmlFromResume(updates.resume);
// è¿™ä¸ªå‡½æ•°å®é™…ä¸Šè¿”å›çš„æ˜¯: resume.raw_text

// åº”è¯¥æ”¹ä¸º:
const html = await fetchFormattedResume(resume.id);
// è°ƒç”¨åç«¯æ¨¡æ¿å¡«å……APIï¼Œè¿”å›æ ¼å¼åŒ–HTML
```

---

## ğŸ’­ ä¼˜åŒ–æ–¹å‘å»ºè®®

åŸºäºä»¥ä¸Šåˆ†æï¼Œæˆ‘å¯ä»¥çœ‹å‡ºä¸»è¦æœ‰**3ä¸ªä¼˜åŒ–æ–¹å‘**:

### æ–¹å‘1: å¢å¼ºè§£æèƒ½åŠ› ğŸ”¬
- ä½¿ç”¨LLMæ›¿ä»£è§„åˆ™åŒ¹é…
- ä¿ç•™PDFåŸå§‹å¸ƒå±€ä¿¡æ¯
- æ›´æ™ºèƒ½çš„ç« èŠ‚è¯†åˆ«

### æ–¹å‘2: å®Œå–„æ•°æ®æµ ğŸ”„
- è®©å‰ç«¯ä½¿ç”¨structured data
- è°ƒç”¨æ¨¡æ¿å¡«å……API
- æ¸²æŸ“æ ¼å¼åŒ–HTML

### æ–¹å‘3: ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ âœ¨
- å¯è§†åŒ–ç¼–è¾‘ç»“æ„åŒ–å†…å®¹
- å®æ—¶é¢„è§ˆ
- æ™ºèƒ½å»ºè®®

---

æ‚¨è§‰å¾—åº”è¯¥ä¼˜å…ˆä»å“ªä¸ªæ–¹å‘ä¼˜åŒ–ï¼Ÿæˆ‘å¯ä»¥è¯¦ç»†å±•å¼€å…·ä½“çš„å®ç°æ–¹æ¡ˆã€‚ğŸ¤”




