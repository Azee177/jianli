# ğŸ¤– æ™ºèƒ½å¯¹è¯åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- âœ… **å¤šè½®å¯¹è¯**: æ”¯æŒä¸Šä¸‹æ–‡è¿ç»­å¯¹è¯ï¼ŒAIèƒ½è®°ä½ä¹‹å‰çš„å¯¹è¯å†…å®¹
- âœ… **å¤šLLMæ”¯æŒ**: æ”¯æŒé€šä¹‰åƒé—®ã€DeepSeekã€OpenAIä¸‰ç§LLM
- âœ… **ä¼šè¯ç®¡ç†**: è‡ªåŠ¨ç®¡ç†å¯¹è¯å†å²ï¼Œä¿æŒ20è½®æœ€è¿‘å¯¹è¯
- âœ… **ä¸“ä¸šåŠ©æ‰‹**: å†…ç½®ç®€å†ä¼˜åŒ–åŠ©æ‰‹äººè®¾ï¼Œæä¾›ä¸“ä¸šå»ºè®®
- âœ… **å®æ—¶å“åº”**: æµç•…çš„å¯¹è¯ä½“éªŒï¼Œå¸¦æ‰“å­—åŠ¨ç”»

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¬¬1æ­¥ï¼šé…ç½® LLM API Key

1. åœ¨ `apps/api` ç›®å½•ä¸‹åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cd apps/api
touch .env
```

2. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œæ·»åŠ API keyï¼ˆæ¨èä½¿ç”¨é€šä¹‰åƒé—®ï¼‰ï¼š

```env
# é€šä¹‰åƒé—®é…ç½®
QWEN_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
QWEN_MODEL=qwen-turbo
DEFAULT_LLM_PROVIDER=qwen
```

**è·å– API Key**ï¼š
- é€šä¹‰åƒé—®: https://dashscope.console.aliyun.com/apiKey
- DeepSeek: https://platform.deepseek.com/api_keys
- OpenAI: https://platform.openai.com/api-keys

### ç¬¬2æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡

```bash
cd apps/api
python -m uvicorn app.main:app --reload --port 8000
```

éªŒè¯æœåŠ¡ï¼šæ‰“å¼€ http://localhost:8000/docs æŸ¥çœ‹APIæ–‡æ¡£

### ç¬¬3æ­¥ï¼šå¯åŠ¨å‰ç«¯æœåŠ¡

```bash
cd apps/web
npm run dev
```

æ‰“å¼€ http://localhost:3000

### ç¬¬4æ­¥ï¼šæµ‹è¯•å¯¹è¯åŠŸèƒ½

1. ç‚¹å‡»å·¦ä¾§æ´»åŠ¨æ çš„ **å¯¹è¯** å›¾æ ‡ï¼ˆç¬¬ä¸€ä¸ªï¼‰
2. åœ¨è¾“å…¥æ¡†è¾“å…¥æ¶ˆæ¯ï¼Œä¾‹å¦‚ï¼š"ä½ å¥½ï¼Œå¸®æˆ‘ä¼˜åŒ–ç®€å†"
3. ç­‰å¾…AIå›å¤ï¼ˆä¼šæ˜¾ç¤ºæ‰“å­—åŠ¨ç”»ï¼‰
4. ç»§ç»­å¤šè½®å¯¹è¯ï¼ŒAIä¼šè®°ä½ä¸Šä¸‹æ–‡

---

## ğŸ“– API æ¥å£è¯´æ˜

### POST /chat/message

å‘é€å¯¹è¯æ¶ˆæ¯

**è¯·æ±‚ä½“**ï¼š
```json
{
  "message": "ä½ å¥½ï¼Œå¸®æˆ‘ä¼˜åŒ–ç®€å†",
  "session_id": "session_xxx",  // å¯é€‰ï¼Œç”¨äºä¿æŒä¸Šä¸‹æ–‡
  "system_message": "ä½ æ˜¯...",  // å¯é€‰ï¼Œè‡ªå®šä¹‰ç³»ç»Ÿæç¤ºè¯
  "temperature": 0.7,           // å¯é€‰ï¼Œ0-1ä¹‹é—´
  "max_tokens": 2000,           // å¯é€‰ï¼Œæœ€å¤§ç”Ÿæˆtokenæ•°
  "provider": "qwen"            // å¯é€‰ï¼ŒæŒ‡å®šLLMæä¾›è€…
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "session_id": "session_demo-user_1234567890.123",
  "message": "ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ä¸“å±ç®€å†ä¼˜åŒ–åŠ©æ‰‹...",
  "history_length": 2,
  "provider": "qwen"
}
```

### POST /chat/history

è·å–å¯¹è¯å†å²

**è¯·æ±‚ä½“**ï¼š
```json
{
  "session_id": "session_xxx"
}
```

### POST /chat/reset

é‡ç½®ä¼šè¯

**è¯·æ±‚ä½“**ï¼š
```json
{
  "session_id": "session_xxx"
}
```

### GET /chat/sessions

åˆ—å‡ºæ‰€æœ‰æ´»è·ƒä¼šè¯

---

## ğŸ”§ å‰ç«¯é›†æˆç¤ºä¾‹

### ä½¿ç”¨ sendChatMessage Hook

```typescript
import { sendChatMessage } from '@/lib/fastapi-hooks';

const handleSend = async (message: string) => {
  try {
    const response = await sendChatMessage({
      message,
      session_id: sessionId || undefined,
      temperature: 0.7,
      provider: 'qwen'
    });
    
    console.log('AIå›å¤:', response.message);
    setSessionId(response.session_id);
  } catch (error) {
    console.error('å¯¹è¯å¤±è´¥:', error);
  }
};
```

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§è¯¦è§£

### 1. å¯¹è¯è®°å¿†æœºåˆ¶

- **Session ID**: å‰ç«¯è‡ªåŠ¨ç”Ÿæˆå¹¶ä¿æŒï¼Œæ ¼å¼ï¼š`session_{user_id}_{timestamp}`
- **å†å²å­˜å‚¨**: åç«¯å†…å­˜å­˜å‚¨ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®ç”¨Redisï¼‰
- **é•¿åº¦é™åˆ¶**: ä¿ç•™æœ€è¿‘20è½®å¯¹è¯ + system message
- **è‡ªåŠ¨æ¸…ç†**: Sessionè¿‡é•¿æ—¶è‡ªåŠ¨æˆªæ–­æ—§æ¶ˆæ¯

### 2. å¤šLLMæ”¯æŒ

**é€šä¹‰åƒé—® (Qwen)**ï¼š
- æ¨¡å‹ï¼šqwen-turbo / qwen-plus / qwen-max
- ä¼˜ç‚¹ï¼šå¿«é€Ÿå“åº”ï¼Œæ€§ä»·æ¯”é«˜ï¼Œä¸­æ–‡æ”¯æŒå¥½
- ä»·æ ¼ï¼šÂ¥0.0008-0.004/åƒtokens

**DeepSeek**ï¼š
- æ¨¡å‹ï¼šdeepseek-chat
- ä¼˜ç‚¹ï¼šç¼–ç¨‹èƒ½åŠ›å¼ºï¼Œä»·æ ¼ä¾¿å®œ
- ä»·æ ¼ï¼šÂ¥0.001/åƒtokens

**OpenAI**ï¼š
- æ¨¡å‹ï¼šgpt-4-turbo / gpt-3.5-turbo
- ä¼˜ç‚¹ï¼šç†è§£èƒ½åŠ›å¼ºï¼Œç¨³å®šæ€§å¥½
- ä»·æ ¼ï¼š$0.01-0.03/åƒtokens

### 3. ç³»ç»Ÿæç¤ºè¯

é»˜è®¤ç³»ç»Ÿæç¤ºè¯ï¼š
```
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç®€å†ä¼˜åŒ–åŠ©æ‰‹ã€‚ä½ å–„äºå¸®åŠ©ç”¨æˆ·ä¼˜åŒ–ç®€å†å†…å®¹ï¼Œ
æä¾›é’ˆå¯¹æ€§çš„å»ºè®®ï¼Œå¹¶ç”¨æ¸…æ™°ã€å‹å¥½çš„è¯­è¨€ä¸ç”¨æˆ·äº¤æµã€‚
```

å¯ä»¥åœ¨å‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯æ—¶è‡ªå®šä¹‰ï¼š
```typescript
sendChatMessage({
  message: "ä½ å¥½",
  system_message: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é¢è¯•æ•™ç»ƒ..."
});
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: ç‚¹å‡»å‘é€åæ²¡æœ‰å“åº”

**æ£€æŸ¥æ¸…å•**ï¼š
1. âœ… åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼Ÿ`http://localhost:8000/health`
2. âœ… `.env` æ–‡ä»¶æ˜¯å¦æ­£ç¡®é…ç½®ï¼Ÿ
3. âœ… API key æ˜¯å¦æœ‰æ•ˆï¼Ÿ
4. âœ… æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰æŠ¥é”™ï¼Ÿ

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥åç«¯æ—¥å¿—
cd apps/api
python -m uvicorn app.main:app --reload --port 8000

# æŸ¥çœ‹æ˜¯å¦æœ‰ LLM è°ƒç”¨æ—¥å¿—
# åº”è¯¥çœ‹åˆ°ç±»ä¼¼: "Calling qwen LLM"
```

### é—®é¢˜2: æç¤º "No LLM providers configured"

**åŸå› **: `.env` æ–‡ä»¶ä¸­æ²¡æœ‰é…ç½®ä»»ä½• API key

**è§£å†³æ–¹æ³•**ï¼š
1. ç¡®è®¤ `.env` æ–‡ä»¶åœ¨ `apps/api` ç›®å½•ä¸‹
2. æ£€æŸ¥æ˜¯å¦é…ç½®äº† `QWEN_API_KEY` æˆ–å…¶ä»–LLMçš„key
3. é‡å¯åç«¯æœåŠ¡

### é—®é¢˜3: API key å·²é…ç½®ä½†ä»ç„¶å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- API key æ ¼å¼é”™è¯¯ï¼ˆç¼ºå°‘ `sk-` å‰ç¼€ç­‰ï¼‰
- API key å·²è¿‡æœŸæˆ–è¢«æ’¤é”€
- è´¦æˆ·ä½™é¢ä¸è¶³
- ç½‘ç»œæ— æ³•è®¿é—®LLMæœåŠ¡

**è§£å†³æ–¹æ³•**ï¼š
1. é‡æ–°ç”Ÿæˆ API key
2. æ£€æŸ¥è´¦æˆ·ä½™é¢
3. æµ‹è¯•ç½‘ç»œè¿æ¥

### é—®é¢˜4: å¯¹è¯æ²¡æœ‰ä¸Šä¸‹æ–‡è®°å¿†

**åŸå› **: Session ID æ²¡æœ‰æ­£ç¡®ä¿æŒ

**è§£å†³æ–¹æ³•**ï¼š
- å‰ç«¯å·²è‡ªåŠ¨ç®¡ç† session_idï¼Œæ£€æŸ¥ `sessionId` state æ˜¯å¦æ­£ç¡®æ›´æ–°
- å¦‚æœåˆ‡æ¢äº†å¯¹è¯tabï¼Œä¼šç”Ÿæˆæ–°çš„session

---

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### 1. ä¼˜åŒ–å¯¹è¯è´¨é‡

**æ˜ç¡®æŒ‡ä»¤**ï¼š
```
âŒ "ä¼˜åŒ–ä¸€ä¸‹"
âœ… "å¸®æˆ‘ä¼˜åŒ–å·¥ä½œç»å†éƒ¨åˆ†ï¼Œçªå‡ºé¡¹ç›®ç®¡ç†å’Œå›¢é˜Ÿåä½œèƒ½åŠ›"
```

**æä¾›ä¸Šä¸‹æ–‡**ï¼š
```
âœ… "æˆ‘è¦åº”è˜å­—èŠ‚è·³åŠ¨çš„äº§å“ç»ç†å²—ä½ï¼Œå¸®æˆ‘ä¼˜åŒ–è¿™æ®µç»å†..."
```

### 2. å¤šè½®å¯¹è¯ç­–ç•¥

```
ç¬¬1è½®: "ä½ å¥½ï¼Œæˆ‘è¦ä¼˜åŒ–ç®€å†åº”è˜äº§å“ç»ç†"
ç¬¬2è½®: "é‡ç‚¹çªå‡ºæ•°æ®åˆ†æèƒ½åŠ›"
ç¬¬3è½®: "å†åŠ ä¸Šç”¨æˆ·å¢é•¿çš„æ¡ˆä¾‹"
```

### 3. åˆ‡æ¢LLMæä¾›è€…

åœ¨å‰ç«¯ä»£ç ä¸­ä¿®æ”¹ `provider` å‚æ•°ï¼š

```typescript
// ä½¿ç”¨ DeepSeekï¼ˆç¼–ç¨‹ç›¸å…³é—®é¢˜ï¼‰
provider: 'deepseek'

// ä½¿ç”¨ GPT-4ï¼ˆå¤æ‚æ¨ç†ï¼‰
provider: 'openai'

// ä½¿ç”¨é€šä¹‰åƒé—®ï¼ˆæ—¥å¸¸å¯¹è¯ï¼‰
provider: 'qwen'
```

---

## ğŸ“Š æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   HTTP    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   API    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ UI     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€> â”‚  FastAPI     â”‚ â”€â”€â”€â”€â”€â”€> â”‚  LLM æœåŠ¡   â”‚
â”‚ (React)     â”‚           â”‚  /chat/      â”‚          â”‚ (Qwen/GPT)  â”‚
â”‚             â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  message     â”‚ <â”€â”€â”€â”€â”€â”€ â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   JSON    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   JSON   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”œâ”€ Session ç®¡ç†
                              â”œâ”€ å¯¹è¯å†å²
                              â””â”€ å¤šLLMè·¯ç”±
```

**æ ¸å¿ƒç»„ä»¶**ï¼š
- `apps/web/src/components/chat/SmartChatInterface.tsx` - å‰ç«¯å¯¹è¯UI
- `apps/web/src/lib/fastapi-hooks.ts` - APIè°ƒç”¨hooks
- `apps/api/app/routes/chat.py` - å¯¹è¯è·¯ç”±
- `apps/api/app/agents/llm_service.py` - LLMæœåŠ¡

---

## ğŸ¨ è‡ªå®šä¹‰æ‰©å±•

### æ·»åŠ æ–°çš„å¯¹è¯æ¨¡å¼

1. ä¿®æ”¹ç³»ç»Ÿæç¤ºè¯ï¼š

```typescript
const systemMessages = {
  resume: "ä½ æ˜¯ç®€å†ä¼˜åŒ–åŠ©æ‰‹...",
  interview: "ä½ æ˜¯é¢è¯•æ•™ç»ƒ...",
  career: "ä½ æ˜¯èŒä¸šè§„åˆ’é¡¾é—®..."
};
```

2. æ ¹æ®æ¨¡å¼é€‰æ‹©æç¤ºè¯ï¼š

```typescript
sendChatMessage({
  message: userInput,
  system_message: systemMessages[mode]
});
```

### é›†æˆåˆ°å…¶ä»–æ‰©å±•

å…¶ä»–æ‰©å±•ä¹Ÿå¯ä»¥ä½¿ç”¨å¯¹è¯åŠŸèƒ½ï¼š

```typescript
import { sendChatMessage } from '@/lib/fastapi-hooks';

// åœ¨ CompanyJobExtension ä¸­ä½¿ç”¨
const getJobAdvice = async (jobDescription: string) => {
  const response = await sendChatMessage({
    message: `åŸºäºè¿™ä¸ªJDæä¾›å»ºè®®: ${jobDescription}`,
    system_message: "ä½ æ˜¯èŒä½åˆ†æä¸“å®¶..."
  });
  return response.message;
};
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç¯å¢ƒé…ç½®æŒ‡å—](apps/api/ENV_CONFIG_GUIDE.md)
- [FastAPI æ–‡æ¡£](http://localhost:8000/docs)
- [é€šä¹‰åƒé—®æ–‡æ¡£](https://help.aliyun.com/zh/dashscope/)
- [DeepSeek æ–‡æ¡£](https://platform.deepseek.com/api-docs/)

---

## ğŸ¤ æ”¯æŒä¸åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æ£€æŸ¥ï¼š
1. åç«¯æ—¥å¿— - æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. æµè§ˆå™¨æ§åˆ¶å° - æŸ¥çœ‹å‰ç«¯æŠ¥é”™
3. API æ–‡æ¡£ - http://localhost:8000/docs

Happy Chatting! ğŸ‰

