流程应该是：
用户上传PDF简历文件，ocr解析文本内容，保存一下用户照片丢进我们的模板中

解析之后先询问用户想要投递的岗位是什么、目标公司是什么，像ChatGPT的深度研究模式一样，让用户有种拥有一对一服务的感觉，再给出几条合适的工作岗位给用户进行考虑

然后根据用户需要投递的岗位去（优先去目标公司）或者大厂官网找出同一个岗位的jd，十五条共性四到五条——套出完美符合（本质上是供需匹配。把这几条共性需求在对话框的复选项中列出来保存，用户可以再次对llm总结的这些共性进行修改值到满意为止

待用户确认后现在正式开始对简历内容进行优化，根据llm总结的这些共性，去对用户简历中的某些经历进行细化修改，先给一个大概的初稿，然后再对用户进行询问之后优化项目或者经历中的具体细节，这个时候用户可以编辑简历区中的简历内容再次选中之后在对话区中进行提问。需要再最后留1/4的内容专门针对用户提到的这个具体公司的具体岗位根据公司文化调性和企业需求写的几乎一致。

确认简历已经修改完成之后，针对简历中的重难点和jd共性中的知识点列出来给用户做准备（是学习网址b站的课程链接和一些针对性的调用llm生成的总结）

再针对简历上的点模拟面试官的问题问简历中的技术细节点或者详细情况了解

用户支持一键导出pdf或者word格式简历便于自行修改

我们的目标是帮助用户改出一份专属于某一公司某一个岗位的最高度匹配简历
（主要是互联网大厂字节腾讯百度阿里巴巴等），最后支持官网投递链接和更新简历记录看板，提醒用户多去官网更新简历



明白啦！你的产品**始终只让用户确认 1 个“最想去的目标岗位”**。下面是把这个约束融入到整套流程后的**精确工作流/状态机/交互与接口**（在不做评分、除 OCR 外全用 LLM 的前提下）。

------

# 0. 上传与解析（非 LLM）

- **输入**：PDF 简历（可含照片）
- **处理**：OCR + 版面分析 → `resume_ast.json`；抽取头像写入模板位
- **状态**：`resume_ast`、`user_avatar`、`template_id`

------

# 1. 一对一接待 → “只确认 1 个目标岗位”

目标：让用户**浏览**建议，但**只能确认 1 个**“最想去”的目标岗位；确认后锁定，所有后续步骤只围绕它展开。

**1.1 引导问答（LLM）**

- 问：岗位方向、目标公司、城市/级别、校招/实习/社招
- 产出：候选清单（5–8 条，可含目标公司的同岗备选）

**1.2 单选确认**

- UI：候选卡片可展开对比，但**底部只有一个「确认该岗位」主按钮**
- 规则：
  - 只能选 1 个；确认后写入 `target_role`，其它候选置灰（保留为“备忘”，不参与后续流程）
  - 若用户想换目标：需**显式“重新选择”**，这会**清空后续状态**（JD/共性/改写稿等），避免混淆

**状态**：`target_role = {company, title, city?, level?, link?}`

------

# 2. JD 抓取（只围绕已确认的 1 个岗位）

- **优先抓取**：目标公司官网 JD（若链接无效，提示用户粘贴 JD 文本）
- **LLM 去噪/字段定位**：岗位名、职责、要求、必备技能、加分项、城市、发布时间、KPI线索
- **输出**：`jd_clean.json`（仅该目标岗位）

> 说明：这里仍可让用户**查看同岗备选**，但不再参与后续计算；它们仅作“对比参考卡片”，**没有确认按钮**。

------

# 3. “15 → 4–5”共性维度（只针对该 JD）

- **LLM 拆分 JD** 为 15–20 条原子能力点 → **聚合成 4–5 条共性维度**（带典型证据句/同义词/可量化指标）
- **UI**：以**复选项 + 可编辑输入**呈现，但默认**全选**（因为我们只对齐这 1 个岗位）
- **用户可编辑**：改名/合并/拆分/重排；**完成后点击“锁定共性”**
- **状态**：`common_dims_locked = true`，保存 `common_dims.json`

> 规则：**未锁定不可进入下一步**；锁定后若想修改，需“解锁”，会触发 **第 4 步首稿重算** 提示。

------

# 4. 首轮对齐草稿（仅面向目标岗位）

- **LLM 读取**：`resume_ast` + `common_dims`
- **产出**：
  - 逐段映射：匹配/弱匹配/缺失 + 具体**补齐建议**（指标/工具/方法/业务场景）
  - **整体改写首稿**：保持原结构，针对弱匹配与缺失段**生成替代段**（STAR + 量化 + 工具链）
  - **预留 1/4 公司定制区**（空位 + 引导要点：价值观/核心场景/KPI 语言）
- **UI**：diff 视图（新增绿色、删改灰色、指标数值加粗）

**状态**：`rewrite_v1.json`、`gap_suggestions[]`

------

# 5. 多轮打磨（编辑器选区 × 对话协作）

- **选区右键（LLM）**：STAR 化 / 量化 / 翻译 / 降重 / 合并重复 / 公司风格包
- **三档返回**：稳健/优化/激进 + diff + 映射到的共性标签
- **防虚构**：可能估算时输出黄色确认条与可替代表述
- **版本管理**：每次提交形成 `rewrite_versions[]`，支持回滚

> 交互限制：所有建议与问答**仅针对当前目标岗位**上下文生成，避免跨岗位漂移。

------

# 6. 公司定制 1/4 区（完全对齐该公司该岗位）

- **LLM 读取**：目标公司官网/价值观/技术博客（或用户粘贴要点）
- **生成模块**：
  1. 价值观呼应
  2. 岗位/业务核心场景映射
  3. 该岗 KPI/成功度量（镜像 JD 表述）
  4. 我的方法迁移与风险权衡
  5. 30/60/90 天计划（可选）
- **语气**：镜像公司措辞与节奏
- **结果**：`company_quarter_block.json` 插入保留的 1/4 占位

------

# 7. 准备清单 & 模拟面试（基于该 JD 共性与简历重难点）

**7.1 准备清单（LLM）**

- 从 `common_dims` + 重难点段落抽取**知识点列表**
- 为每条生成：**B站课程链接/官方文档/实践博客 + LLM 摘要 + 验证题**
- 输出：`prep_kit.json`（今日/本周学习卡）

**7.2 模拟面试（LLM）**

- 对“每段经历 × 共性”自动生成 **基础/进阶/挑战** 追问
- 附答案提纲与反问；用户作答可回填到简历或备注

------

# 8. 导出 & 投递 & 更新看板（只针对该岗位）

- **导出**：PDF/Word（嵌入字体/头像、固定排版）
- **投递助手**（本地插件）：
  - 给出**该岗位的官网投递链接**
  - **LLM 在本地**做表单字段语义映射（自我介绍/职责摘要/技能关键字）
- **更新看板**：
  - 记录该岗位的投递时间、简历版本、备注
  - **更新提醒**：定期提示进入官网更新简历（附“安全微调包”）

------

## 状态机（仅 1 个目标岗位）

```
UPLOAD -> PARSE_OK
PARSE_OK -> INTENT_COLLECTING
INTENT_COLLECTING -> TARGET_CONFIRMED(only 1)
TARGET_CONFIRMED -> JD_FETCHED(target only)
JD_FETCHED -> COMMON_DIMS_LOCKED
COMMON_DIMS_LOCKED -> DRAFT_V1
DRAFT_V1 <-> REWRITE_LOOP (multi-iteration)
REWRITE_LOOP -> COMPANY_QUARTER_DONE
COMPANY_QUARTER_DONE -> PREP_READY & INTERVIEW_READY
PREP_READY -> EXPORTABLE
EXPORTABLE -> SUBMISSION_TRACKING
(RESELECT_TARGET) => resets to TARGET_CONFIRMED (and clears downstream states)
```

**清空策略（当用户“重新选择目标岗位”时）**

- 清空：`jd_clean`、`common_dims`、`rewrite_v1`、`rewrite_versions`、`company_quarter_block`、`prep_kit`、`interview_tree`
- 保留：`resume_ast`、`user_avatar`、`template_id`（避免重复 OCR）

------

## 接口（只保留单目标语义）

- `POST /parse/ocr` → `resume_ast.json`
- `POST /intent/collect`（LLM 对话）→ 候选列表（仅用于**浏览**）
- `POST /intent/confirm_target` → `target_role`（**唯一必选**）
- `POST /jd/fetch`（基于 `target_role`）→ `jd_clean.json`
- `POST /jd/commonize`（单 JD）→ `common_dims.json`
- `POST /resume/draft_v1` → `rewrite_v1.json`
- `POST /resume/rewrite_selection` → `rewrite_versions[]`
- `POST /resume/company_quarter` → `company_quarter_block.json`
- `POST /prep/kit` → `prep_kit.json`
- `POST /interview/tree` → `interview_tree.json`
- `POST /export` → PDF/Word
- `POST /submit/board` → `update_board.json`
- `POST /intent/reselect_target` → 清空下游状态并回到 `TARGET_CONFIRMED`

------

## 关键 UI 约束（确保“只确认 1 个”）

- 候选岗位卡片：**仅提供一个「确认该岗位」主按钮**；确认后其它卡片**置灰且不可选**
- 顶部显示“目标岗位：公司 | 岗位 | 城市”，旁边只有一个“**重新选择**”小按钮（危险色/带确认弹窗）
- 共性维度面板：标题标注“**针对：公司-岗位**”；切换目标前不可编辑
- 面试/准备清单/导出/投递看板：均在标题中显示目标岗位，防止误用

------

## LLM 提示词差异（适配单目标）

- **JD 共性提取**：

  > “仅针对此 JD，将职责/要求拆为原子点并去重，再聚为 4–5 个上位共性；给出同义词、可量化指标与原文证据。不要引用其他公司的语言。”

- **首稿对齐**：

  > “基于此 JD 的共性维度，改写简历（STAR+量化），未覆盖处给补齐建议；保持事实，不可虚构；为公司定制区预留占位要点。”

- **公司定制 1/4 区**：

  > “镜像该公司公开材料的措辞与节奏，生成价值观呼应、场景匹配、KPI与方法迁移、风险权衡、30/60/90 计划（可选）。”

------

## 风险与兜底

- JD 下线/无法抓取 → 提示用户**粘贴 JD 文本**或**上传截图**（LLM 做 OCR+抽取）
- 用户频繁切换目标 → 二次确认：“更换将清空共性与改写稿”等
- 数据真实性 → 黄色确认条 + 可替代表述模板
- 合规 → 投递表单填充在本地；提醒遵守官网频率与条款

------

这样设计后，用户从一开始就被引导**选定 1 个唯一目标**，并且后续所有 LLM 能力（共性提炼、改写、公司定制、学习与面试）都**强绑定这个目标**，避免跑偏，保证“**专属于某一公司某一岗位的最高匹配简历**”。